### 微博评论高可用架构方案

##### 性能估算

背景：2.5亿活跃用户

三个关键环节：

1. 发微博

2. 评论微博

3. 看微博

   基本上在量级上做10倍等比数列去做估计是合理的，假如假设平均每天每个用户发1条微博，则评论微博平均为10条评论。也即评论总数每天2.5亿 ✖️ 10 = 25亿。

   时间段据课上讲的内容，评论微博也基本重合，因此TPS为25亿*60%/（4✖️3600）=100k/s

##### 业务特性分析

​		微博评论是一个对数据即时更新有相当容忍度的非典型的写操作，因此可以利用写缓冲结构，实现同步转异步的一个转换，可以用kafka消息队列。当然，在其上用负载均衡也是有必要的，毕竟tps量级已经相当可观。

##### 架构分析

​		用户量过亿，采用多级负载均衡，F5 --- LVS --- Nginx --- 网关，同时采用kafka当blocking queue，实现写缓冲效果，将用户请求由同步转异步，减轻系统压力。

##### 架构设计

​		此处并无太复杂业务，且数据关系基本“平等”，可以简单采用轮询/随机算法。

​		写缓冲用kafka集群实现。

​		业务服务器数量，每台按500/s标准，100k/s总共需要200台服务器，预留25%性能余量，总共250台服务器即可满足

##### 非热点事件架构图

<img src="https://github.com/gavin-ao/Architecht/blob/main/微博评论高可用架构图.drawio.png" alt="微博评论高可用架构图.drawio" style="zoom:50%;" />

##### 热点事件

​		对于微博评论来说，热点事件对于业务服务器影响不大，中间的kafka集群进行动态扩容即可。
